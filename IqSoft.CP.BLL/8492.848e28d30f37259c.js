"use strict";(self.webpackChunkAgentManagmentSystem=self.webpackChunkAgentManagmentSystem||[]).push([[8492],{8492:(k,h,l)=>{l.r(h),l.d(h,{AgentComponent:()=>L});var m=l(1368),t=l(2116),g=l(180),r=l(2100),u=l(2064),v=l(2236),C=l(9288);function f(i,c){if(1&i){const e=t.KQA();t.I0R(0,"span",11),t.qCj("click",function(){t.usT(e);const n=t.GaO(2);return t.CGJ(n.resetClickItem())}),t.OEk(1),t.C$Y()}if(2&i){const e=t.GaO(2);t.m4B("text-decoration",1===e.agentIdArray.length?"underline":"none"),t.yG2(),t.MjK("",e.agentIds.includes(",")?e.agentIds.split(",")[0]:e.agentIds,"_",e.agentUserName,"",e.agentLevelName," ")}}function b(i,c){if(1&i){const e=t.KQA();t.I0R(0,"div",14)(1,"span",15),t.qCj("click",function(){const n=t.usT(e),s=n.$implicit,o=n.index,d=t.GaO(3);return t.CGJ(d.handleIdClick(null==s?null:s.Id,o+1))}),t.I0R(2,"span",16),t.OEk(3,"/"),t.C$Y(),t.OEk(4),t.C$Y()()}if(2&i){const e=c.$implicit;t.yG2(4),t.MjK("",null==e?null:e.Id,"_",null==e?null:e.UserName,"",null==e?null:e.LevelName," ")}}function O(i,c){if(1&i&&(t.I0R(0,"div",12),t.yuY(1,b,5,3,"div",13),t.C$Y()),2&i){const e=t.GaO(2);t.yG2(),t.E7m("ngForOf",e.agentIdArray)}}function P(i,c){if(1&i&&(t.I0R(0,"div",8),t.yuY(1,f,2,5,"span",9)(2,O,2,1,"div",10),t.C$Y()),2&i){const e=t.GaO();t.yG2(),t.E7m("ngIf",1===e.agentIdArray.length),t.yG2(),t.E7m("ngIf",e.agentIds&&e.agentIdArray.length>1)}}function y(i,c){if(1&i){const e=t.KQA();t.I0R(0,"a",17,18),t.qCj("click",function(){const s=t.usT(e).$implicit,o=t.GaO();return t.CGJ(o.setActiveTabLabel(s))}),t.OEk(2),t.wVc(3,"translate"),t.C$Y()}if(2&i){const e=c.$implicit,a=t.Gew(1);t.E7m("routerLink",e.route)("queryParamsHandling","merge")("active",a.isActive),t.yG2(2),t.cNF(t.kDX(3,4,e.label))}}const A=()=>["/main/agents"],M=i=>({level:i});let L=(()=>{class i{constructor(){this.activatedRoute=(0,t.uUt)(r.gV),this.router=(0,t.uUt)(r.E5),this.agentService=(0,t.uUt)(C.Y),this.enumService=(0,t.uUt)(v.Y),this.tabs=[{label:"Common.MainInfo",route:"main"},{label:"Common.Corrections",route:"corrections"},{label:"Common.Downline",route:"downline"},{label:"Common.CommissionPlan",route:"commission-plan"},{label:"Menus.Employees",route:"employees"},{label:"Menus.Clients",route:"clients"}],this.backupTabs=[],this.activeLink=this.tabs[0].route,this.activeTabLabel=this.tabs[0].label,this.agentLevel="",this.showDatas=!1,this.backupTabs=[...this.tabs]}ngOnInit(){this.setupAgentIds(),this.router.events.subscribe(s=>{if(s instanceof r.MT){this.setupAgentIds();let o=this.agentIds?.split(",");o?.length<this.agentIdArray.length?(this.agentIdArray.splice(-1,1),localStorage.setItem("agentData",JSON.stringify(this.agentIdArray))):o?.length===this.agentIdArray.length&&localStorage.setItem("agentData",JSON.stringify(this.agentIdArray)),this.getAgent(),history.replaceState({selectedTab:this.activeTabLabel},"")}this.router.url.includes("/agents/agent")||(localStorage.removeItem("agentData"),this.agentIdArray=[],this.activatedRoute.snapshot.queryParams={})});const n=this.router.url.split("?")[0].split("/");this.currentRoute=n[n.length-1],this.activeTabLabel=this.getLabelForRoute(this.currentRoute),this.userId=this.activatedRoute.snapshot.queryParams.agentId,this.getAgent(),this.getAgentLevelsEnum(),window.addEventListener("popstate",s=>{s.state&&s.state.selectedTab&&(this.activeTabLabel=s.state.selectedTab)})}setupAgentIds(){let e=this.activatedRoute.snapshot.queryParams;if(e&&e.agentId){if(this.agentIds=e.agentId,this.userId=this.agentIds.split(",")[0],this.agentIds.split(",").length>1){const s=this.tabs.findIndex(o=>"Common.Corrections"===o.label);-1!==s&&this.tabs.splice(s,1)}else this.tabs=this.backupTabs.slice();const n=localStorage.getItem("agentData");n?(this.agentIdArray=JSON.parse(n),this.agentIdArray.some(s=>!s.LevelName)&&this.getUserForLevels()):this.agentIdArray=this.agentIds.split(",").map(s=>({Id:s})),this.showDatas=!0}else{if(this.agentIds=this.activatedRoute.snapshot.queryParams.agentId,this.userId=this.agentIds?.split(",")[0],this.agentIds=e.agentId,this.userId=this.agentIds?.split(",")[0],this.agentIds?.split(",")?.length>1){const n=this.tabs.findIndex(s=>"Common.Corrections"===s.label);-1!==n&&this.tabs.splice(n,1)}else this.tabs=this.backupTabs.slice();if(this.agentIds){const n=localStorage.getItem("agentData");this.agentIdArray=n?JSON.parse(n):this.agentIds.split(",").map(s=>({Id:s}))}}}setActiveTabLabel(e){this.activeTabLabel=e.label}getLabelForRoute(e){const a=this.tabs.find(n=>n.route===e);return a?a.label:""}getUserLevelTypes(){this.enumService.getAgentLevels().subscribe(e=>{0===e.ResponseCode&&(this.userLevelTypes=e.ResponseObject)})}setAgentLevel(){this.agentLevel=this.userLevelTypes?.find(e=>e.Id==this.level)?.Name}getAgent(){let e;if(this.agentIds){let a=this.agentIds.split(",");e=+a[a.length-1]}else e=+this.userId;this.agentService.getAgents({Id:e,WithDownlines:!0}).subscribe(a=>{if(0===a.ResponseCode){const n=a.ResponseObject.Agents.Entities[0];this.level=n?.Level,this.agentLevelId=n?.Level,this.agentUserName=n?.UserName,this.agentLevelName=this.getLevelNameById(this.agentLevelId),this.setAgentLevel()}})}getUserForLevels(){this.agentIdArray&&this.agentIdArray.forEach(e=>{this.agentService.getAgents({Id:+e.Id,WithDownlines:!0}).subscribe(n=>{if(0===n.ResponseCode){const s=n.ResponseObject.Agents?.Entities[0]?.Level,o=this.getLevelNameById(s);e.LevelName=o,e.UserName=n.ResponseObject.Agents?.Entities[0]?.UserName,localStorage.setItem("agentData",JSON.stringify(this.agentIdArray))}})})}getLevelNameById(e){const a=this.agentsLevelsEnums?.find(n=>n?.Id===e);return a?"("+a?.Name+")":""}getAgentLevelsEnum(){this.enumService.getAgentLevelsEnum(this.userId).subscribe(e=>{0===e.ResponseCode&&(this.agentsLevelsEnums=e.ResponseObject,this.agentLevelName=`(${this.agentsLevelsEnums?.find(a=>a.Id===this.agentLevelId)?.Name})`)})}handleIdClick(e,a){const n={...this.activatedRoute.snapshot.queryParams};if(n.agentId){const o=n.agentId.split(","),d=o.indexOf(e);if(-1!==d){const E=o.slice(0,d+1);n.agentId=E.join(",");const I=localStorage.getItem("agentData");if(I){const _=JSON.parse(I).slice(0,a+1);localStorage.setItem("agentData",JSON.stringify(_)),this.agentIdArray=_.map(p=>({LevelName:p.LevelName,UserName:p.UserName}))}}}else n.agentId=e;let s="main";this.router.navigate(["/main/agents/agent/"+s],{queryParams:n}),this.activeTabLabel=s}resetClickItem(){localStorage.removeItem("agentData");const a={agentId:this.agentIds.includes(",")?this.agentIds.split(",")[0]:this.agentIds};let n="main";this.router.navigate(["/main/agents/agent/"+n],{queryParams:a}),this.activeTabLabel=n}static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["app-agent"]],standalone:!0,features:[t.UHJ],decls:16,vars:13,consts:[[1,"container"],[1,"content-action"],[1,"title"],[1,"title-link",3,"routerLink","queryParams"],["class","title-container",4,"ngIf"],[1,"selected-tab"],["mat-tab-nav-bar","","mat-align-tabs","start",1,"detail-nav-tabs",3,"tabPanel"],["tabPanel",""],[1,"title-container"],["class","title-link-item",3,"text-decoration","click",4,"ngIf"],["class","agentIds",4,"ngIf"],[1,"title-link-item",3,"click"],[1,"agentIds"],["class","agentIdsItems",4,"ngFor","ngForOf"],[1,"agentIdsItems"],[1,"agentIdsItems-list",3,"click"],[1,"slash"],["mat-tab-link","","routerLinkActive","",3,"routerLink","queryParamsHandling","active","click"],["rla","routerLinkActive"],["mat-tab-link","","routerLinkActive","",3,"routerLink","queryParamsHandling","active"]],template:function(a,n){if(1&a&&(t.I0R(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),t.OEk(4),t.wVc(5,"translate"),t.C$Y(),t.yuY(6,P,3,2,"div",4),t.I0R(7,"span",5),t.OEk(8),t.wVc(9,"translate"),t.C$Y()()()(),t.I0R(10,"nav",6),t.c53(11,y,4,6,"a",19,t.wJt),t.C$Y(),t.I0R(13,"mat-tab-nav-panel",null,7),t.wR5(15,"router-outlet"),t.C$Y()),2&a){const s=t.Gew(14);t.yG2(3),t.E7m("routerLink",t.q4q(10,A))("queryParams",t.S45(11,M,n.level)),t.yG2(),t.cNF(t.kDX(5,6,"Agents.Agents")),t.yG2(2),t.E7m("ngIf",n.showDatas),t.yG2(2),t.oRS("/",t.kDX(9,8,n.activeTabLabel),""),t.yG2(2),t.E7m("tabPanel",s),t.yG2(),t.oho(n.tabs)}},dependencies:[m.MD,m.ay,m.u_,g.WG,g.Ir,g.QP,g.QH,r.qQ,r.cP,r.ER,r.LC,u.O0,u.sD],styles:[".container[_ngcontent-%COMP%]{height:auto;padding:0 20px;background-color:#f0f5f8}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;height:68px;padding:0}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:20px;letter-spacing:.04em;color:#3f4e67;flex:1;padding:0}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{display:flex}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .title-link[_ngcontent-%COMP%]{margin-right:5px;text-decoration:none;color:#3f4e67;cursor:pointer}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .title-link-item[_ngcontent-%COMP%]{cursor:pointer}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .agentIds[_ngcontent-%COMP%]{display:flex;align-items:center}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .agentIds[_ngcontent-%COMP%]   .agentIdsItems[_ngcontent-%COMP%]{cursor:pointer}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .agentIds[_ngcontent-%COMP%]   .agentIdsItems[_ngcontent-%COMP%]:last-child{text-decoration:underline;pointer-events:none;cursor:default}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .agentIds[_ngcontent-%COMP%]   .agentIdsItems[_ngcontent-%COMP%]:first-child   .agentIdsItems-list[_ngcontent-%COMP%]   .slash[_ngcontent-%COMP%]{display:none}.detail-nav-tabs[_ngcontent-%COMP%]{padding:0}@media screen and (max-width: 768px){.title[_ngcontent-%COMP%]{font-size:16px!important;font-weight:500;color:var(--text-1, rgb(31, 31, 31))!important}.mat-mdc-tab-link[_ngcontent-%COMP%]{background-color:#f5f5f5!important;margin-right:4px;height:39px!important}body.theme-dark[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#fff!important}body.theme-dark[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{background-color:#303030!important}}"]})}return i})()}}]);