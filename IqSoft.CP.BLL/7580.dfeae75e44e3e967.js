"use strict";(self.webpackChunkAgentManagmentSystem=self.webpackChunkAgentManagmentSystem||[]).push([[7580],{7580:(v,_,c)=>{c.r(_),c.d(_,{TicketComponent:()=>x});var g=c(1368),a=c(6504),l=c(7816),m=c(3840),C=c(1560),P=c(2096),d=c(2064),O=c(6e3),t=c(2116),p=c(8196),u=c(748),M=c(2100);function h(s,r){if(1&s){const n=t.KQA();t.I0R(0,"button",7),t.qCj("click",function(){t.usT(n);const o=t.GaO();return t.CGJ(o.closeTicket())}),t.OEk(1),t.wVc(2,"translate"),t.C$Y()}2&s&&(t.yG2(),t.cNF(t.kDX(2,1,"Notifications.CloseTicket")))}function f(s,r){1&s&&(t.I0R(0,"div",12),t.OEk(1),t.wVc(2,"translate"),t.C$Y()),2&s&&(t.yG2(),t.cNF(t.kDX(2,1,"Common.TicketClosed")))}function k(s,r){if(1&s&&(t.I0R(0,"div",13)(1,"div",14)(2,"div",15),t.OEk(3),t.C$Y(),t.I0R(4,"div",16)(5,"div"),t.OEk(6),t.C$Y(),t.I0R(7,"div"),t.OEk(8),t.C$Y()()()()),2&s){const n=r.$implicit;t.eAK("left",1===n.Type),t.yG2(),t.eAK("left",1===n.Type),t.yG2(2),t.cNF(n.Message),t.yG2(3),t.CAO("",n.UserLastName," - ",n.UserId,""),t.yG2(2),t.cNF(n.CreationTime)}}function T(s,r){if(1&s){const n=t.KQA();t.I0R(0,"div",17)(1,"div",18)(2,"textarea",19),t.iHE("ngModelChange",function(o){t.usT(n);const i=t.GaO();return t.kNx(i.messageText,o)||(i.messageText=o),t.CGJ(o)}),t.C$Y(),t.I0R(3,"button",7),t.qCj("click",function(){t.usT(n);const o=t.GaO();return t.CGJ(o.sendMessage())}),t.OEk(4,"send"),t.C$Y()()()}if(2&s){const n=t.GaO();t.yG2(2),t.OKB("ngModel",n.messageText)}}let x=(()=>{class s{constructor(n,e,o,i,b){this._signalR=n,this.localStorageService=e,this.snackbarService=o,this.activateRoute=i,this.router=b,this.messages=[],this.messageText=""}ngOnInit(){this.ticketId=this.activateRoute.snapshot.queryParams.ticketId,this.status=+this.activateRoute.snapshot.queryParams.status,this._signalR.init(),this.signalRSubscription=this._signalR.connectionEmitter.subscribe(n=>{!0===n&&this.getTicketMessages()})}closeTicket(){const n={TicketId:this.ticketId,Token:this.localStorageService.get("auth_token")};this._signalR.connection.invoke("CloseTicket",n).then(e=>{0===e.ResponseCode?(this.status=2,this.router.navigate([],{relativeTo:this.activateRoute,queryParams:{TicketId:this.ticketId,status:this.status},queryParamsHandling:"merge"}).then(()=>{}),this.snackbarService.showSuccess("Ticket successfully closed")):this.snackbarService.showError(e.R.Description)})}sendMessage(){const n={TicketId:this.ticketId,Token:this.localStorageService.get("auth_token"),Message:this.messageText};this._signalR.connection.invoke("CreateMessage",n).then(e=>{0===e.ResponseCode?""!=e.ResponseObject.Message&&(this.messages.push(e.ResponseObject),this.messageText=""):this.snackbarService.showError(e.Description)})}refreshTicket(){this.getTicketMessages()}getTicketMessages(){const n={TicketId:this.ticketId,Token:this.localStorageService.get("auth_token")};this._signalR.connection.invoke("GetTicketMessages",n).then(e=>{0===e.ResponseCode?this.messages=e.ResponseObject:this.snackbarService.showError(e.Description)})}onNavigateToTickets(){this.router.navigate(["/main/notifications/tickets"])}ngOnDestroy(){this.signalRSubscription.unsubscribe(),this._signalR.stop()}static#t=this.\u0275fac=function(e){return new(e||s)(t.GI1(O.U),t.GI1(p.s),t.GI1(u.i),t.GI1(M.gV),t.GI1(M.E5))};static#n=this.\u0275cmp=t.In1({type:s,selectors:[["app-ticket"]],standalone:!0,features:[t.M5G([O.U]),t.UHJ],decls:18,vars:11,consts:[[1,"container"],[1,"content-action"],[1,"title"],[3,"click"],[1,"btn-content"],["mat-stroked-button","","class","mat-btn",3,"click",4,"ngIf"],["class","closed-text",4,"ngIf"],["mat-stroked-button","",1,"mat-btn",3,"click"],[1,"refresh"],[1,"message-sent"],["class","message-content",3,"left",4,"ngFor","ngForOf"],["class","message-send",4,"ngIf"],[1,"closed-text"],[1,"message-content"],[1,"chat-content"],[1,"message-text"],[1,"info"],[1,"message-send"],[1,"send-content"],[1,"message-text",3,"ngModel","ngModelChange"]],template:function(e,o){1&e&&(t.I0R(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),t.qCj("click",function(){return o.onNavigateToTickets()}),t.OEk(4),t.wVc(5,"translate"),t.C$Y(),t.OEk(6),t.C$Y(),t.I0R(7,"div",4),t.yuY(8,h,3,3,"button",5)(9,f,3,3,"div",6),t.C$Y(),t.I0R(10,"button",7),t.qCj("click",function(){return o.refreshTicket()}),t.I0R(11,"mat-icon",8),t.OEk(12,"refresh"),t.C$Y(),t.OEk(13),t.wVc(14,"translate"),t.C$Y()(),t.I0R(15,"div",9),t.yuY(16,k,9,8,"div",10),t.C$Y(),t.yuY(17,T,5,1,"div",11),t.C$Y()),2&e&&(t.yG2(4),t.cNF(t.kDX(5,7,"Common.Ticket")),t.yG2(2),t.oRS(" : ",o.ticketId," "),t.yG2(2),t.E7m("ngIf",1===o.status),t.yG2(),t.E7m("ngIf",2===o.status),t.yG2(4),t.oRS(" ",t.kDX(14,9,"Common.Refresh")," "),t.yG2(3),t.E7m("ngForOf",o.messages),t.yG2(),t.E7m("ngIf",1===o.status))},dependencies:[g.MD,g.ay,g.u_,d.O0,d.sD,m.Vn,P.d5,l.oJ,l.Gw,C.oB,C.qL,a.y,a.ot,a.ue,a._G],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;padding:0 10px;box-sizing:border-box}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]{height:6%;display:flex;align-items:center;flex-wrap:wrap}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.04em;color:#076192;flex:1;padding-left:10px}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#076192}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#000}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{cursor:pointer}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]{background-color:#239dff;padding:10px;border:1px solid #239dff;min-width:104px;color:#fff;border-radius:4px;font-size:16px;font-weight:500;margin-left:12px}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]     .mat-button-wrapper{color:#fff!important}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn.disabled[_ngcontent-%COMP%]{color:#076192!important;background-color:#a0c4d8;pointer-events:none}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn.disabled[_ngcontent-%COMP%]     .mat-button-wrapper{color:#076192!important}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]:hover{cursor:pointer;border:1px solid #076192;background:linear-gradient(#076192,#258ecd 50%,#0573ba)}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .closed-text[_ngcontent-%COMP%]{font-size:24px;color:#0573ba}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:hover{cursor:pointer}.container[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]{height:630px;overflow:auto}.container[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.container[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]   .message-content.left[_ngcontent-%COMP%]{justify-content:flex-end}.container[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]{border-radius:4px;margin:12px 0;max-width:250px;width:100%;background-color:#a0c4d7}.container[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .chat-content.left[_ngcontent-%COMP%]{background-color:#a8a8a8}.container[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{padding:12px}.container[_ngcontent-%COMP%]   .message-sent[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .chat-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{padding:12px;text-align:end}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]{text-align:end;max-width:250px;width:100%}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{display:block;border-radius:4px;border:1px solid #076192;padding:12px;outline:none;height:92px;width:100%;box-sizing:border-box}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]:focus{box-shadow:0 0 10px #00000026;border:1px solid #076192}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]{width:100%;margin-top:10px;background-color:#239dff;padding:10px;border:1px solid #239dff;min-width:104px;color:#fff;border-radius:4px;font-size:16px;font-weight:500}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]     .mat-button-wrapper{color:#fff!important}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]   .mat-btn.disabled[_ngcontent-%COMP%]{color:#076192!important;background-color:#a0c4d8;pointer-events:none}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]   .mat-btn.disabled[_ngcontent-%COMP%]     .mat-button-wrapper{color:#076192!important}.container[_ngcontent-%COMP%]   .message-send[_ngcontent-%COMP%]   .send-content[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]:hover{cursor:pointer;border:1px solid #076192;background:linear-gradient(#076192,#258ecd 50%,#0573ba)}"]})}return s})()}}]);