"use strict";(self.webpackChunkAgentManagmentSystem=self.webpackChunkAgentManagmentSystem||[]).push([[6632],{516:(_,p,a)=>{a.d(p,{E:()=>C});var l=a(2116),h=a(7408),m=a(7672),r=(a(7024),a(5648));let C=(()=>{class d extends h.K{constructor(i){super(i),this.filterService=(0,l.uUt)(r.q),this.pagination=!0,this.paginationAutoPageSize=!1,this.paginationPageSize=100,this.cacheBlockSize=100,this.suppressPaginationPanel=!1,this.rowModelType=m.kt.SERVER_SIDE,this.serverSideStoreType="full",this.pageSizes=[100,500,1e3,2e3,5e3],this.defaultPageSize=100,this.paginationPage=1,this.defaultColDef={flex:1,editable:!1,filter:"agTextColumnFilter",resizable:!0,unSortIcon:!1,menuTabs:["filterMenuTab","generalMenuTab"],minWidth:15}}onFilterModified(i){this.colId=i.column.colId}keyPressHandler(i){if(document.querySelector(".ag-theme-balham .ag-popup")&&this.colId&&this.gridApi&&"13"===i.key){const t=this.gridApi.getFilterInstance(this.colId);this.colId=void 0,t&&t.applyModel(),this.gridApi.onFilterChanged(),this.gridApi.hidePopupMenu()}}onPaginationChanged(i){const o=this.gridApi?.paginationGetCurrentPage();isNaN(o)||(this.paginationPage=o+1)}onPaginationGoToPage(i){"Enter"===i.key&&(i.preventDefault(),this.gridApi?.paginationGoToPage(this.paginationPage-1))}setFilter(i,o){this.isEmpty(i)||Object.entries(i).forEach(([t,n])=>{const e=t+"s";if(o[e]={ApiOperationTypeList:[],IsAnd:this.getIsAnd(n.operator)},n.hasOwnProperty("condition1")&&n.condition1&&o[e].ApiOperationTypeList.push(this.mapFilterData(n.condition1)),n.hasOwnProperty("condition2")&&n.condition2)o[e].ApiOperationTypeList.push(this.mapFilterData(n.condition2));else{if(0===n.ApiOperationTypeList?.length)return;o[e].ApiOperationTypeList.push(this.mapFilterData(n))}})}mapFilterData(i){const o={OperationTypeId:i.type};switch(i.filterType){case"number":const t=parseFloat(i.filter);isNaN(t)||(o.DecimalValue=t,o.IntValue=Math.round(t));break;case"text":void 0!==i.filter&&(o.StringValue=i.filter);break;case"date":o.DateTimeValue=void 0!==i.dateFrom?i.dateFrom:new Date;break;case"boolean":void 0!==i.filter&&(o.BooleanValue=1===i.filter);break;case"set":o.OperationTypeId=11,void 0!==i.values&&(o.ArrayValue=i.values)}return console.log(o,"appendedFilter"),o}setFilterDropdown(i,o){const t=i.request.filterModel;for(const n of o)t[n]&&!t[n].filter&&(t[n].hasOwnProperty("condition1")?(t[n].condition1.filter=t[n].condition1.type,t[n].condition2.filter=t[n].condition2.type,t[n].condition1.type=1,t[n].condition2.type=1):(t[n].filter=t[n].type,t[n].type=1))}changeFilerName(i,o,t){for(let n=0;n<o.length;n++){const e=o[n];i[e]&&(i[t[n]]=i[e],delete i[e])}}static#e=this.\u0275fac=function(o){return new(o||d)(l.GI1(l.zZn))};static#t=this.\u0275dir=l.Sc5({type:d,standalone:!0,features:[l.eg9]})}return d})()},6632:(_,p,a)=>{a.r(p),a.d(p,{ClientCommissionPlanComponent:()=>O});var l=a(1368),h=a(4796),m=a(516),f=a(6692),r=a(2116),C=a(748);const d=["agGrid"];let O=(()=>{class i extends m.E{constructor(t,n){super(t),this.injector=t,this.snackbarService=n,this.components={numericEditor:h.K},this.isServerSideGroup=e=>e.group,this.getServerSideGroupKey=e=>e.Id,this.autoGroupColumnDef={headerName:"GroupId",field:"Id",checkboxSelection:!0,cellRendererParams:{innerRenderer:e=>e.data.Id}},this.createServerSideDatasource=()=>({getRows:e=>{const s={SkipCount:0,TakeCount:-1};-1==e.parentNode.level?s.ProductId=1:s.ParentId=e.parentNode.data.Id,this.setFilter(e.request.filterModel,s),this.mainService.getProducts(s).subscribe(u=>{if(0===u.ResponseCode){const g=u.ResponseObject;Array.isArray(g)?(g.forEach(c=>{c.group=!c.IsLeaf,this.mappedData.forEach(P=>{P.ProductId===c.Id?(c.TurnoverPercent=P.TurnoverPercent,c.Percent=P.Percent):(c.TurnoverPercent=null,c.Percent=null)})}),e.success({rowData:g,rowCount:g.length})):this.snackbarService.showError("Invalid data format: Entities is not an array")}else this.snackbarService.showError(u.Description)})}}),this.columnDefs=[{headerName:"Common.Common.Id",headerValueGetter:this.localizeHeader.bind(this),field:"Id",hide:!0},{headerName:"Common.Name",headerValueGetter:this.localizeHeader.bind(this),field:"Name",editable:!0,onCellValueChanged:e=>this.onCellValueChanged(e),filter:"agTextColumnFilter",filterParams:{buttons:["apply","reset"],closeOnApply:!0,filterOptions:this.filterService.textOptions}},{headerName:"Common.ParentId",headerValueGetter:this.localizeHeader.bind(this),field:"ParentId"},{headerName:"Common.Percent",headerValueGetter:this.localizeHeader.bind(this),field:"Percent",editable:!0,onCellValueChanged:e=>this.onCellValueChanged(e),filter:"agTextColumnFilter",filterParams:{buttons:["apply","reset"],closeOnApply:!0,filterOptions:this.filterService.textOptions},cellEditor:"numericEditor"},{headerName:"Common.TurnoverPercent",headerValueGetter:this.localizeHeader.bind(this),field:"TurnoverPercent",editable:!0,onCellValueChanged:e=>this.onCellValueChanged(e),filter:"agTextColumnFilter",filterParams:{buttons:["apply","reset"],closeOnApply:!0,filterOptions:this.filterService.textOptions},cellEditor:"numericEditor"},{headerName:"Common.State",headerValueGetter:this.localizeHeader.bind(this),field:"State",cellRenderer:e=>0===e.data.State?"Inactive":1===e.data.State?"Active":""}]}ngOnInit(){this.clientId=this.route.snapshot.queryParams.clientId,this.getCommissionPlan()}getCommissionPlan(){this.mainService.getCommissionPlan({ClientId:this.clientId}).subscribe(t=>{0===t.ResponseCode?this.mappedData=t.ResponseObject:this.snackbarService.showError(t.Description)})}onGridReady(t){this.gridApi=t.api,this.gridApi.setServerSideDatasource(this.createServerSideDatasource())}onCellValueChanged(t){this.mainService.updateCommissionPlan({ClientId:this.clientId,ProductId:t.data.Id,TurnoverPercent:t.data.TurnoverPercent,Percent:t.data.Percent||null}).subscribe(e=>{0===e.ResponseCode||this.snackbarService.showError(e.Description)})}static#e=this.\u0275fac=function(n){return new(n||i)(r.GI1(r.zZn),r.GI1(C.i))};static#t=this.\u0275cmp=r.In1({type:i,selectors:[["app-client-commission-plan"]],viewQuery:function(n,e){if(1&n&&r.CC$(d,5),2&n){let s;r.wto(s=r.Gqi())&&(e.agGrid=s.first)}},standalone:!0,features:[r.eg9,r.UHJ],decls:7,vars:16,consts:[[1,"container"],[1,"content-action"],[1,"title"],[1,"grid-content"],[1,"ag-theme-balham",3,"headerHeight","rowHeight","rowData","enableGroupEdit","autoGroupColumnDef","rowModelType","columnDefs","defaultColDef","treeData","animateRows","components","cacheBlockSize","isServerSideGroup","getServerSideGroupKey","ensureDomOrder","enableCellTextSelection","gridReady"],["agGrid",""]],template:function(n,e){1&n&&(r.I0R(0,"div",0)(1,"div",1)(2,"div",2),r.OEk(3,"Products"),r.C$Y()(),r.I0R(4,"div",3)(5,"ag-grid-angular",4,5),r.qCj("gridReady",function(u){return e.onGridReady(u)}),r.C$Y()()()),2&n&&(r.yG2(5),r.E7m("headerHeight",e.headerHeight)("rowHeight",e.rowHeight)("rowData",e.rowData)("enableGroupEdit",!0)("autoGroupColumnDef",e.autoGroupColumnDef)("rowModelType",e.rowModelType)("columnDefs",e.columnDefs)("defaultColDef",e.defaultColDef)("treeData",!0)("animateRows",!0)("components",e.components)("cacheBlockSize",1e4)("isServerSideGroup",e.isServerSideGroup)("getServerSideGroupKey",e.getServerSideGroupKey)("ensureDomOrder",!0)("enableCellTextSelection",!0))},dependencies:[l.MD,f.Oc,f.U5],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;padding:0 10px;box-sizing:border-box}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]{height:6%;display:flex;align-items:center;flex-wrap:wrap}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.04em;color:#076192;flex:1;padding-left:10px}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#076192}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#000}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]{margin-left:8px;background-color:#239dff;padding:10px;border:1px solid #239dff;min-width:104px;color:#fff;border-radius:4px;font-size:16px;font-weight:500}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]     .mat-button-wrapper{color:#fff!important}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn.disabled[_ngcontent-%COMP%]{color:#076192!important;background-color:#a0c4d8;pointer-events:none}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn.disabled[_ngcontent-%COMP%]     .mat-button-wrapper{color:#076192!important}.container[_ngcontent-%COMP%]   .content-action[_ngcontent-%COMP%]   .mat-btn[_ngcontent-%COMP%]:hover{cursor:pointer;border:1px solid #076192;background:linear-gradient(#076192,#258ecd 50%,#0573ba)}.container[_ngcontent-%COMP%]   .grid-content[_ngcontent-%COMP%]{width:100%;height:77vh}.container[_ngcontent-%COMP%]   .grid-content[_ngcontent-%COMP%]     ag-grid-angular{width:100%;height:100%}"]})}return i})()}}]);